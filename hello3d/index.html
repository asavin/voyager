<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Voyager Mission</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
		<script src="js/vendor/jquery-1.9.1.min.js"></script>
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
		<script src="js/three.js"></script>
		<script src="js/stats.min.js"></script>
		<script src="js/tween.min.js"></script>
		<script src="js/main.js"></script>
		<script src="js/jquery.cycle.all.js"></script>
		<script src="js/jquery.easing.1.3.js"></script>
    </head>
    <body>	
		<div class="overlay" id="mypopup">Voyager 1 mission control</div>
		
		<div class="year">1976</div>
		
		<script type="text/javascript">
			$(document).ready(function(){
				$('.slideshow').cycle({
					fx:'shuffle', 
					easing: 'easeOutBack',
					pause: 1,
					autostop: 5
				});
			});
		</script>
		<div class="slideshow photo_section">
				<a href="http://en.wikipedia.org/wiki/File:Titan_3E_with_Voyager_1.jpg" target=_blank><img src="img/Titan_3E_with_Voyager_1.jpg" width="200" height="200"/><div class="voyager_pic_description">Voyager 1 lifted off with a Titan IIIE-Centaur </div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Great_Red_Spot_From_Voyager_1.jpg" target=_blank><img src="img/Great_Red_Spot_From_Voyager_1.jpg" width="200" height="200"/><div class="voyager_pic_description">The Great Red Spot as seen from Voyager 1</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Jupiter_from_Voyager_1.jpg" target=_blank>
				<img src="img/Jupiter_from_Voyager_1.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">False color detail of Jupiter's atmosphere</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Volcanic_crater_with_radiating_lava_flows_on_Io.jpg" target=_blank>
				<img src="img/Volcanic_crater_with_radiating_lava_flows_on_Io.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">View of lava flows radiating from the volcano Ra Patera on Io</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Vulcanic_Explosion_on_Io.jpg" target=_blank>
				<img src="img/Vulcanic_Explosion_on_Io.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Volcanic eruption on Io photographed from Voyager 1</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Ganymede_-_PIA02278.jpg" target=_blank>
				<img src="img/Ganymede_-_PIA02278.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Icy surface of Ganymede as photographed from 253,000 km</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Valhalla_crater_on_Callisto.jpg" target=_blank>
				<img src="img/Valhalla_crater_on_Callisto.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Valhalla crater on Callisto as imaged by Voyager 1 in 1979</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Vg1_p23254_hires.jpg" target=_blank>
				<img src="img/Vg1_p23254_hires.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Saturn from 5.3 million km, four days after its closest approach</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Voyager_1_-_view_of_Saturn%27s_moon_Mimas.jpg" target=_blank>
				<img src="img/Voyager_1_-_view_of_Saturn%27s_moon_Mimas.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Mimas at a range of 425,000 km from Voyager 1</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Tethys_-_PIA01974.jpg" target=_blank>
				<img src="img/Tethys_-_PIA01974.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Tethys photographed by Voyager 1 from 1.2 million km</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Dione_from_Voyager_1.jpg" target=_blank>
				<img src="img/Dione_from_Voyager_1.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Fractured terrain on Dione</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Rhea_-_PIA02270.jpg" target=_blank>
				<img src="img/Rhea_-_PIA02270.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Impact craters on the surface of Rhea appear similar to Mercury</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Titan%27s_thick_haze_layer-picture_from_voyager1.jpg" target=_blank>
				<img src="img/Titan%27s_thick_haze_layer-picture_from_voyager1.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Titan's thick haze layer is shown in this enhanced Voyager 1 image</div></a>
				
				<a href="http://en.wikipedia.org/wiki/File:Titan_Haze.jpg" target=_blank>
				<img src="img/Titan_Haze.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Layers of haze covering Saturn's satellite Titan</div></a>
				
				<!-- last pic (?) -->
				<a href="http://en.wikipedia.org/wiki/Pale_Blue_Dot" target=_blank>
				<img src="img/pale_blue_dot.jpg" width="200" height="200"/>
				<div class="voyager_pic_description">Pale Blue Dot</div></a>
			</div>
		
		<iframe id="golden_record_playlist" src="https://embed.spotify.com/?uri=spotify:user:ulyssestone:playlist:6pcuzwZSIw7OgL149bgJmZ" width="300" height="380" frameborder="0" allowtransparency="true"></iframe>
		
		<div class="github_link">Twitter - <a href="http://www.twitter.com/karismafilms" target=_blank>@karismafilms</a> GitHub project - <a href="https://github.com/asavin/voyager" target=_blank>https://github.com/asavin/voyager</a></div>
		
		<script>
		
		</script>

		<script type="text/javascript">
		
		// Some initializations
		
		width = document.body.clientWidth;
		height = document.body.clientHeight;
		var renderer = new THREE.WebGLRenderer({antialias: true});
		renderer.setSize(document.body.clientWidth, 
		                       document.body.clientHeight);
							   
		document.body.appendChild(renderer.domElement);
		renderer.setClearColor(0x111111, 1.0);
		renderer.clear();
		
		// Stats
		stats = new Stats();
		stats.domElement.style.position = 'fixed';
		stats.domElement.style.right = '0px';
		stats.domElement.style.bottom = '10px';
		document.body.appendChild(stats.domElement);
		
		// new THREE.PerspectiveCamera( FOV, viewAspectRatio, zNear, zFar );
		var camera = new THREE.PerspectiveCamera(45, width/height, 1, 100000);
		//camera.position.z = 300;
		//camera.position.y = -100;
		
		
		
		
		// Animate camera movement with Tween
		var position = { x : 0, y: -100, z: 300 };
		var target = { x : 400, y: 500, z: -800 };
		var tween = new TWEEN.Tween(position).to(target, 4000);
		
		tween.delay(500);
		tween.easing(TWEEN.Easing.Quadratic.InOut);
		
		tween.onUpdate(function(){
			camera.position = position;
		});
		
		tween.start();
		
		var scene = new THREE.Scene();
		
		
		//var planeGeo = new THREE.PlaneGeometry(400, 200, 10, 10);
		//var planeMat = new THREE.MeshLambertMaterial({color: 0xFFFFFF});
		//var plane = new THREE.Mesh(planeGeo, planeMat);
		//plane.rotation.x = -Math.PI/2;
		//plane.position.y = -25;
		//plane.receiveShadow = true;
		//scene.add(plane);
		
		// lens flares

		var textureFlare0 = THREE.ImageUtils.loadTexture( "img/lensflare/lensflare0.png" );
		var textureFlare2 = THREE.ImageUtils.loadTexture( "img/lensflare/lensflare2.png" );
		var textureFlare3 = THREE.ImageUtils.loadTexture( "img/lensflare/lensflare3.png" );
		
		var light = new THREE.PointLight();
		light.position.set( 0, 0, 0 );
		scene.add(light);
		
		var flareColor = new THREE.Color( 0xffffff );
		flareColor.setHSL( 0.55, 0.9, 0.5 + 0.5 );

		var lensFlare = new THREE.LensFlare( textureFlare0, 700, 0.0, THREE.AdditiveBlending, flareColor );

		lensFlare.add( textureFlare2, 512, 0.0, THREE.AdditiveBlending );
		lensFlare.add( textureFlare2, 512, 0.0, THREE.AdditiveBlending );
		lensFlare.add( textureFlare2, 512, 0.0, THREE.AdditiveBlending );

		lensFlare.add( textureFlare3, 60, 0.6, THREE.AdditiveBlending );
		lensFlare.add( textureFlare3, 70, 0.7, THREE.AdditiveBlending );
		lensFlare.add( textureFlare3, 120, 0.9, THREE.AdditiveBlending );
		lensFlare.add( textureFlare3, 70, 1.0, THREE.AdditiveBlending );

		lensFlare.customUpdateCallback = lensFlareUpdateCallback;
		lensFlare.position = light.position;

		scene.add( lensFlare );
		
		// Create all planets with some scale
		
		var planetEarth = new THREE.Mesh(
		        new THREE.SphereGeometry(10, 10, 10),
		        new THREE.MeshLambertMaterial({color: 0x00B3FF}));
	    scene.add(planetEarth);
	
		var planetMercury = new THREE.Mesh(
		        new THREE.SphereGeometry(5, 5, 5),
		        new THREE.MeshLambertMaterial({color: 0xE9F235}));
		scene.add(planetMercury);
	
		var planetVenus = new THREE.Mesh(
		        new THREE.SphereGeometry(10, 10, 10),
		        new THREE.MeshLambertMaterial({color: 0xF2B035}));
		scene.add(planetVenus);
		
		var planetMars = new THREE.Mesh(
		        new THREE.SphereGeometry(10, 10, 10),
		        new THREE.MeshLambertMaterial({color: 0xB31222}));
		scene.add(planetMars);
		
		var planetJupiter = new THREE.Mesh(
		        new THREE.SphereGeometry(30, 30, 30),
		        new THREE.MeshLambertMaterial({color: 0xEB6117}));
		scene.add(planetJupiter);
		
		var planetSaturn = new THREE.Mesh(
		        new THREE.SphereGeometry(25, 25, 25),
		        new THREE.MeshLambertMaterial({color: 0xE6BC8C}));
				
		var saturnRing = new THREE.Mesh(new THREE.CylinderGeometry(50, 50, 1, 24, 1, false ),new THREE.MeshLambertMaterial( { color: 0xE6BC8C } ));
		scene.add(planetSaturn);
		scene.add(saturnRing);
						
		
		var planetUranus = new THREE.Mesh(
		        new THREE.SphereGeometry(20, 20, 20),
		        new THREE.MeshLambertMaterial({color: 0x3E7018}));
		scene.add(planetUranus);
		
		var planetNeptune = new THREE.Mesh(
		        new THREE.SphereGeometry(20, 20, 20),
		        new THREE.MeshLambertMaterial({color: 0x3D50CC}));
		scene.add(planetNeptune);
				
		//var planet1 = new THREE.Mesh(new THREE.SphereGeometry(20,20,20),
		//              new THREE.MeshBasicMaterial({color: 0xFFFF00}));
		//scene.add(planet1);
		
		// Draw a Voyager spiral
		voyagerSpiral = DrawSpiral(0xDDDDDD);
		voyagerSpiral.rotation.y += 0.5;
		//var xAxis = new THREE.Vector3(0,1,1);
		//rotateAroundObjectAxis(voyagerSpiral, xAxis, Math.PI / 180);
		
		scene.add(voyagerSpiral);
		
		// Create orbit lines for all planets
		mercuryTrackLine = DrawTrackLine(0xE9F235, 70, 0);
		scene.add(mercuryTrackLine);
		
		venusTrackLine = DrawTrackLine(0xF2B035, 120, 0);
		scene.add(venusTrackLine);
		
		earthTrackLine = DrawTrackLine(0x35B3F2, 170, 0);
		scene.add(earthTrackLine);
		
		marsTrackLine = DrawTrackLine(0xB31222, 230, 0);
		scene.add(marsTrackLine);
		
		jupiterTrackLine = DrawTrackLine(0xEB6117, 330, 0);
		scene.add(jupiterTrackLine);
		
		saturnTrackLine = DrawTrackLine(0xE6BC8C, 400, 0);
		scene.add(saturnTrackLine);
		
		uranusTrackLine = DrawTrackLine(0x3E7018, 480, 0);
		scene.add(uranusTrackLine);
		
		neptuneTrackLine = DrawTrackLine(0x3D50CC, 550, 0);
		scene.add(neptuneTrackLine);
		
		plutoTrackLine = DrawTrackLine(0x590B63, 630, 0);
		scene.add(plutoTrackLine);
		
		
		
		// Create the outer stars
		
		var particleCount = 1800,
		    particles = new THREE.Geometry(),
		    pMaterial =
		      new THREE.ParticleBasicMaterial({
		        color: 0xFFFFFF,
		        size: 5,
				map: THREE.ImageUtils.loadTexture(
				      "particle.png"
				),
				blending: THREE.AdditiveBlending,
			    transparent: true
		      });

		// now create the individual particles
		for(var p = 0; p < particleCount; p++) {

		  // create a particle with random
		  // position values, -250 -> 250
		  var pX = Math.random() * 1000 - 500,
		      pY = Math.random() * 1000 - 500,
		      pZ = Math.random() * 1000 - 500,
		      particle = new THREE.Vertex(
		        new THREE.Vector3(pX, pY, pZ)
		      );

		  // add it to the geometry
		  particles.vertices.push(particle);
		}

		// create the particle system
		var particleSystem =
		  new THREE.ParticleSystem(
		    particles,
		    pMaterial);

		// add it to the scene
		scene.add(particleSystem);
		
		// Magic for the mouse
		down=false;
		window.onmousedown = function (ev){
	        down = true; sx = ev.clientX; sy = ev.clientY;
	      };
	      window.onmouseup = function(){ down = false; };
	      window.onmousemove = function(ev) {
	        if (down) {
	          var dx = ev.clientX - sx;
	          var dy = ev.clientY - sy;
	          camera.position.x -= dx;
	          camera.position.y += dy;
	          sx += dx;
	          sy += dy;
	        }
	      };
		
		  function DrawTrackLine(color, radius, position) {
    
		      var size = 360 / radius;
		      var linegeometry = new THREE.Geometry();
		      var material = new THREE.LineBasicMaterial({ color: color, opacity: 1.0 });
		      for (var i = 0; i <= radius; i++) {
		          var segment = (i * size) * Math.PI / 180;
		          linegeometry.vertices.push(new THREE.Vector3(Math.cos(segment) * radius, 0, Math.sin(segment) * radius));
		      }

		      return new THREE.Line(linegeometry, material);
    
		  }
		  
		  function DrawSpiral(color) {
		      var linegeometry = new THREE.Geometry();
		      var material = new THREE.LineBasicMaterial({ color: color, opacity: 1.0 });
			  a = 10;
			  b = 550;
			  centerx = 70;
			  centery = -150;
			  for (var i = 0; i < 20; i++) {
			          angle = 0.1 * i;
			          x = centerx + (a + b * angle) * Math.cos(angle);
			          y = centery + (a + b * angle) * Math.sin(angle);
					  linegeometry.vertices.push(new THREE.Vector3(x, 0, y));
			      }

		      return new THREE.Line(linegeometry, material);
		  
		  }
		
		var dt = 0;
		var current_year = 1976;
		var difference_year = -1;
		
		// Shifts for the planets in 1977, based on the Celestia data
		// Not exactly scientifically accurate, but can be easily adjusted
		var saturnShift = 130000;
		var jupiterShift = 70000;
		var uranusShift = 20000;
		var neptuneShift = -40000;
		
		function animate(t) {
			    
				
		        // you need to update lookAt every frame
		        camera.lookAt(scene.position);
		        
				// Earth orbital motion
				planetEarth.position.x = Math.cos(t/1800)*170;
				planetEarth.position.z = Math.sin(t/1800)*170;
				
				// Animating Mercury
				planetMercury.position.x = Math.cos(t/434)*70;
				planetMercury.position.z = Math.sin(t/434)*70;
				
				// Animating Venus
				planetVenus.position.x = Math.cos(t/1109)*120;
				planetVenus.position.z = Math.sin(t/1109)*120;
				
				// Animating Mars
				planetMars.position.x = Math.cos(t/3388)*230;
				planetMars.position.z = Math.sin(t/3388)*230;
				
				// Animating Jupiter
				planetJupiter.position.x = Math.cos((t+jupiterShift)/21366)*330;
				planetJupiter.position.z = Math.sin((t+jupiterShift)/21366)*330;
				
				// Animating Saturn
				planetSaturn.position.x = Math.cos((t + saturnShift)/53059)*400;
				planetSaturn.position.z = Math.sin((t + saturnShift)/53059)*400;
				saturnRing.position = planetSaturn.position
				
				// Animating Uranus
				planetUranus.position.x = Math.cos((t+uranusShift)/151885)*480;
				planetUranus.position.z = Math.sin((t+uranusShift)/151885)*480;
				
				// Animating Neptune
				planetNeptune.position.x = Math.cos((t+ neptuneShift)/296827)*550;
				planetNeptune.position.z = Math.sin((t+neptuneShift)/296827)*550;
				
				TWEEN.update();
				stats.update();
				
				// Calculating current year since the start of simulation
				dt = t - difference_year * 11400;
				
				if(dt > 11400) {
					dt = 0;
					difference_year += 1;
					$('.year').text(parseInt($('.year').text()) + 1);
					
					// Check for images this year and display if any
					//displayPics();
				}
				
								
				// renderer automatically clears unless autoClear = false
		        renderer.render(scene, camera);
		        window.requestAnimationFrame(animate, renderer.domElement);
		      };
		 animate(new Date().getTime());
		 
		 function lensFlareUpdateCallback( object ) {

			var f, fl = object.lensFlares.length;
			var flare;
			var vecX = -object.positionScreen.x * 2;
			var vecY = -object.positionScreen.y * 2;


			for( f = 0; f < fl; f++ ) {

				   flare = object.lensFlares[ f ];

				   flare.x = object.positionScreen.x + vecX * flare.distance;
				   flare.y = object.positionScreen.y + vecY * flare.distance;

				   flare.rotation = 0;

			}

			object.lensFlares[ 2 ].y += 0.025;
			object.lensFlares[ 3 ].rotation = object.positionScreen.x * 0.5 + THREE.Math.degToRad( 45 );

		}

		// Utility method for rotating objects around its own axis
		function rotateAroundObjectAxis(object, axis, radians) {
		    rotObjectMatrix = new THREE.Matrix4();
		    rotObjectMatrix.makeRotationAxis(axis.normalize(), radians);
		    object.matrix.multiply(rotObjectMatrix);      // post-multiply
		    object.rotation.setEulerFromRotationMatrix(object.matrix, object.scale);
		}
		
		/*function displayPics() {
		    if($('.year').text()=='1977') {
				$('#voyager_pic').fadeOut();
			    $('#voyager_pic').attr('src', 'img/Titan_3E_with_Voyager_1.jpg');
				$('#voyager_pic').fadeIn();
				$('#voyager_pic_description').text("Voyager 1 launch");
			} else if ($('.year').text()=='1978') {
				
			    $('#voyager_pic2').attr('src', 'img/Jupiter_from_Voyager_1.jpg');
				
				$('#voyager_pic_description').text("Jupiter from Voyager");
				$('#voyager_pic2').fadeIn();
				$('#voyager_pic').fadeOut();
			} else if ($('.year').text()=='1979') {
			    $('#voyager_pic').attr('src', 'img/Great_Red_Spot_From_Voyager_1.jpg');
				$('#voyager_pic_description').text("Jupiter from Voyager");
				$('#voyager_pic').fadeIn();
				$('#voyager_pic2').fadeOut();
			}
		}*/

		$('#mylink').click(function(e){
			e.preventDefault();
		    console.log("hello");
			tween.stop();	
		});

		</script>


        <script src="js/plugins.js"></script>
        

    </body>
</html>
